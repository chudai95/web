// 1. Cấu hình kết nối
const mqtt_host = "mqtt.dontseeme.duckdns.org"; 
const mqtt_port = 9443;
const mqtt_path = "/mqtt"; // EMQX bắt buộc phải có đường dẫn này cho Websocket
const use_ssl = true;      // Bắt buộc True vì dùng WSS

// 2. Tạo Client ID ngẫu nhiên
const client_id = "web_client_" + parseInt(Math.random() * 100000);

// 3. Khởi tạo đối tượng Client
// Cú pháp Paho MQTT: new Paho.MQTT.Client(host, port, path, clientId);
client = new Paho.MQTT.Client(mqtt_host, mqtt_port, mqtt_path, client_id);

// 4. Hàm kết nối
function connectMQTT() {
    console.log("Dang ket noi den " + mqtt_host + ":" + mqtt_port);
    client.connect({
        onSuccess: onConnect,     // Hàm chạy khi kết nối thành công
        onFailure: onFail,        // Hàm chạy khi lỗi
        useSSL: use_ssl,          // QUAN TRỌNG: Phải bật SSL
        userName: "noobies", // Thay user của bạn
        password: "123456", // Thay pass của bạn
        keepAliveInterval: 30
    });
}

function onFail(responseObject) {
    console.log("Loi ket noi: " + responseObject.errorMessage);
}

function onConnect() {
    console.log("DA KET NOI THANH CONG!");
    // Subscribe vào topic sau khi kết nối
    client.subscribe("home/quat/control");
}
